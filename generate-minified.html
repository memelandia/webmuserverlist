<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Archivos Minificados</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #0f0f0f; 
            color: #fff; 
        }
        .container { max-width: 800px; margin: 0 auto; }
        .section { 
            background: #1a1a1a; 
            padding: 20px; 
            border-radius: 8px; 
            margin: 20px 0; 
            border: 1px solid #333;
        }
        button { 
            background: #ff3333; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px;
        }
        button:hover { background: #e62e2e; }
        .results { 
            background: #252525; 
            padding: 15px; 
            border-radius: 4px; 
            margin: 10px 0; 
            font-family: monospace;
            font-size: 12px;
        }
        .success { color: #48bb78; }
        .error { color: #f56565; }
        .info { color: #63b3ed; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üóúÔ∏è Generador de Archivos Minificados</h1>
        <p>Genera versiones minificadas de los archivos principales de MuServerList.</p>

        <div class="section">
            <h3>üìÑ CSS Principal</h3>
            <button onclick="generateMinifiedCSS()">Generar style.min.css</button>
            <div class="results" id="css-results"></div>
        </div>

        <div class="section">
            <h3>üìú JavaScript Cr√≠tico</h3>
            <button onclick="generateMinifiedJS()">Generar archivos JS minificados</button>
            <div class="results" id="js-results"></div>
        </div>

        <div class="section">
            <h3>üì¶ Generar Todo</h3>
            <button onclick="generateAll()">üöÄ Generar Todos los Archivos Minificados</button>
            <div class="results" id="all-results"></div>
        </div>
    </div>

    <script>
        function log(container, message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'success' ? '#48bb78' : type === 'error' ? '#f56565' : '#63b3ed';
            const element = document.getElementById(container);
            element.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
        }

        // Funciones de minificaci√≥n
        function minifyCSS(css) {
            return css
                .replace(/\/\*[\s\S]*?\*\//g, '') // Remover comentarios
                .replace(/\s+/g, ' ') // Remover espacios excesivos
                .replace(/\s*([{}:;,>+~])\s*/g, '$1') // Remover espacios alrededor de caracteres especiales
                .replace(/;}/g, '}') // Remover punto y coma antes de }
                .replace(/\s*{\s*/g, '{') // Limpiar llaves
                .replace(/;\s*/g, ';') // Limpiar punto y coma
                .trim();
        }

        function minifyJS(js) {
            return js
                .replace(/\/\/.*$/gm, '') // Remover comentarios de l√≠nea
                .replace(/\/\*[\s\S]*?\*\//g, '') // Remover comentarios de bloque
                .replace(/\s+/g, ' ') // Remover espacios excesivos
                .replace(/\s*([=+\-*/%<>!&|^~?:;,(){}[\]])\s*/g, '$1') // Remover espacios alrededor de operadores
                .replace(/\s*{\s*/g, '{') // Limpiar llaves
                .replace(/;\s*/g, ';') // Limpiar punto y coma
                .trim();
        }

        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type: type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        async function fetchAndMinifyCSS() {
            try {
                log('css-results', 'Descargando css/style.css...', 'info');
                const response = await fetch('css/style.css');
                const cssContent = await response.text();
                
                log('css-results', `Archivo original: ${(cssContent.length / 1024).toFixed(1)} KB`, 'info');
                
                const minifiedCSS = minifyCSS(cssContent);
                const savings = ((cssContent.length - minifiedCSS.length) / cssContent.length * 100).toFixed(1);
                
                log('css-results', `Archivo minificado: ${(minifiedCSS.length / 1024).toFixed(1)} KB`, 'success');
                log('css-results', `Reducci√≥n: ${savings}%`, 'success');
                
                downloadFile(minifiedCSS, 'style.min.css', 'text/css');
                log('css-results', '‚úÖ style.min.css generado y descargado', 'success');
                
                return { original: cssContent.length, minified: minifiedCSS.length, savings };
            } catch (error) {
                log('css-results', `‚ùå Error: ${error.message}`, 'error');
                return null;
            }
        }

        async function fetchAndMinifyJS(filename) {
            try {
                log('js-results', `Descargando ${filename}...`, 'info');
                const response = await fetch(filename);
                const jsContent = await response.text();
                
                const minifiedJS = minifyJS(jsContent);
                const savings = ((jsContent.length - minifiedJS.length) / jsContent.length * 100).toFixed(1);
                
                log('js-results', `${filename}: ${(jsContent.length / 1024).toFixed(1)} KB ‚Üí ${(minifiedJS.length / 1024).toFixed(1)} KB (${savings}%)`, 'success');
                
                const minFilename = filename.replace('.js', '.min.js');
                downloadFile(minifiedJS, minFilename.split('/').pop(), 'text/javascript');
                
                return { original: jsContent.length, minified: minifiedJS.length, savings };
            } catch (error) {
                log('js-results', `‚ùå Error con ${filename}: ${error.message}`, 'error');
                return null;
            }
        }

        async function generateMinifiedCSS() {
            document.getElementById('css-results').innerHTML = '';
            await fetchAndMinifyCSS();
        }

        async function generateMinifiedJS() {
            document.getElementById('js-results').innerHTML = '';
            
            const jsFiles = [
                'js/modules/utils.js',
                'js/modules/api.js',
                'js/modules/ui.js',
                'js/modules/lazy-loading.js',
                'js/main.js',
                'js/explorar.js'
            ];

            let totalOriginal = 0;
            let totalMinified = 0;
            let processedFiles = 0;

            for (const file of jsFiles) {
                const result = await fetchAndMinifyJS(file);
                if (result) {
                    totalOriginal += result.original;
                    totalMinified += result.minified;
                    processedFiles++;
                }
                // Peque√±a pausa entre archivos
                await new Promise(resolve => setTimeout(resolve, 200));
            }

            const totalSavings = ((totalOriginal - totalMinified) / totalOriginal * 100).toFixed(1);
            log('js-results', `üìä Resumen: ${processedFiles} archivos procesados`, 'info');
            log('js-results', `üìä Total: ${(totalOriginal / 1024).toFixed(1)} KB ‚Üí ${(totalMinified / 1024).toFixed(1)} KB`, 'success');
            log('js-results', `üìä Reducci√≥n total: ${totalSavings}%`, 'success');
        }

        async function generateAll() {
            document.getElementById('all-results').innerHTML = '';
            log('all-results', 'üöÄ Iniciando generaci√≥n completa...', 'info');

            // Generar CSS minificado
            log('all-results', 'üìÑ Procesando CSS...', 'info');
            const cssResult = await fetchAndMinifyCSS();

            // Generar JS minificados
            log('all-results', 'üìú Procesando JavaScript...', 'info');
            const jsFiles = [
                'js/modules/utils.js',
                'js/modules/api.js',
                'js/modules/ui.js',
                'js/modules/cache.js',
                'js/modules/lazy-loading.js',
                'js/main.js',
                'js/explorar.js'
            ];

            let totalJSOriginal = 0;
            let totalJSMinified = 0;
            let processedJSFiles = 0;

            for (const file of jsFiles) {
                const result = await fetchAndMinifyJS(file);
                if (result) {
                    totalJSOriginal += result.original;
                    totalJSMinified += result.minified;
                    processedJSFiles++;
                }
                await new Promise(resolve => setTimeout(resolve, 100));
            }

            // Resumen final
            const totalOriginal = (cssResult ? cssResult.original : 0) + totalJSOriginal;
            const totalMinified = (cssResult ? cssResult.minified : 0) + totalJSMinified;
            const totalSavings = totalOriginal > 0 ? ((totalOriginal - totalMinified) / totalOriginal * 100).toFixed(1) : 0;

            log('all-results', 'üìä RESUMEN FINAL:', 'info');
            log('all-results', `üìÑ CSS: ${cssResult ? 'Procesado' : 'Error'}`, cssResult ? 'success' : 'error');
            log('all-results', `üìú JavaScript: ${processedJSFiles} archivos procesados`, 'success');
            log('all-results', `üì¶ Tama√±o total original: ${(totalOriginal / 1024).toFixed(1)} KB`, 'info');
            log('all-results', `üóúÔ∏è Tama√±o total minificado: ${(totalMinified / 1024).toFixed(1)} KB`, 'success');
            log('all-results', `üíæ Reducci√≥n total: ${(totalOriginal - totalMinified) / 1024} KB (${totalSavings}%)`, 'success');
            log('all-results', '‚úÖ Generaci√≥n completa finalizada', 'success');

            // Generar reporte
            const report = {
                timestamp: new Date().toISOString(),
                files: {
                    css: cssResult ? 1 : 0,
                    js: processedJSFiles
                },
                sizes: {
                    originalTotal: totalOriginal,
                    minifiedTotal: totalMinified,
                    savings: totalOriginal - totalMinified,
                    savingsPercent: totalSavings
                }
            };

            downloadFile(JSON.stringify(report, null, 2), 'minification-report.json', 'application/json');
            log('all-results', 'üìÑ Reporte de minificaci√≥n descargado', 'info');
        }

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üóúÔ∏è Generador de archivos minificados cargado');
        });
    </script>
</body>
</html>
